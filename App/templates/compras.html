{% extends "base.html" %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='compras.css') }}">
{% endblock %}

{% block contenido %}

<h2>Registrar Compra</h2>

<form method="POST" class="form-compra">

    <!-- Selector de catálogo -->
    <select id="selector-producto">
        <option value="">Seleccionar del catálogo (opcional)</option>
        {% for p in productos_catalogo %}
        <option 
            data-nombre="{{ p.nombre }}"
            data-descripcion="{{ p.descripcion }}"
            data-precio="{{ p.precio }}">
            {{ p.nombre }}
        </option>
        {% endfor %}
    </select>

    <!-- Campos editables -->
    <input name="nombre" id="nombre"
           placeholder="Nombre del producto" required>

    <input name="descripcion" id="descripcion"
           placeholder="Descripción" required>

    <input type="number" step="0.01"
           name="costo_empresarial"
           placeholder="Costo empresarial"
           required>

    <input type="number" step="0.01"
           name="precio_publico"
           id="precio_publico"
           placeholder="Precio público"
           required>

    <input type="number" name="piezas" id="piezas"
       placeholder="Número de piezas"
       min="1" required>


    <input type="date" value="{{ hoy }}" readonly>

    <button type="submit">Guardar Compra</button>

</form>

<hr>

<h2>Compras Registradas</h2>

<div class="grid-compras">
    {% for compra in compras %}
    <div class="card-compra">
        <h3>{{ compra.nombre }}</h3>
        <p>{{ compra.descripcion }}</p>

        <div class="precios">
            <span>Costo: ${{ compra.costo_empresarial }}</span>
            <span>Público: ${{ compra.precio_publico }}</span>
        </div>

        <div class="margen">
            Margen:
            ${{ compra.precio_publico - compra.costo_empresarial }}
        </div>

        <div class="piezas">
        Piezas: {{ compra.piezas }}
        </div>


        <div class="fecha">
            Fecha: {{ compra.fecha }}
        </div>
    </div>
    {% endfor %}
</div>

<!-- Script para autocompletar -->
<script>
document.getElementById("selector-producto").addEventListener("change", function() {
    let selected = this.options[this.selectedIndex];

    if (selected.value !== "") {
        document.getElementById("nombre").value =
            selected.getAttribute("data-nombre");

        document.getElementById("descripcion").value =
            selected.getAttribute("data-descripcion");

        document.getElementById("precio_publico").value =
            selected.getAttribute("data-precio");
    }
});
</script>

{% endblock %}

